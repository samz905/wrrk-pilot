# =============================================================================
# ORCHESTRATOR CREW TASKS - Sequential Multi-Task Architecture (v3.4)
# =============================================================================
# 5 tasks chained via context=[previous_task]:
# 1. plan_strategy -> Analyze product, create prospecting plan
# 2. reddit_prospecting -> Execute Reddit stepped workflow
# 3. techcrunch_prospecting -> Execute TechCrunch workflow (SERP-based)
# 4. competitor_prospecting -> Execute competitor displacement workflow
# 5. aggregate_leads -> Combine, filter, rank final leads (warmest first)
# =============================================================================

plan_strategy:
  description: |
    Analyze the product and create a prospecting strategy plan.

    INPUT:
    - Product: {product_description}
    - Target: {target_leads} leads
    - ICP: {icp_criteria}

    YOUR TASK - Create a strategy plan (NOT execution):

    1. IDENTIFY the product category
       - What type of product is this?
       - Who are likely competitors?
       - What pain points does it solve?

    2. GENERATE Reddit search queries (2-3 variations):
       - Direct query: "project management tool"
       - Pain-based: "frustrated with Asana"
       - Alternative-seeking: "alternative to Monday.com"

    3. DEFINE TechCrunch focus:
       - Target industry/sector
       - Funding stages to prioritize (Seed, Series A, B, C)
       - Decision maker titles to target

    OUTPUT a structured plan for the execution specialists.

  expected_output: |
    A strategy plan with:
    - product_category: What type of product
    - competitors: List of likely competitors
    - reddit_queries: 2-3 search queries
    - techcrunch_focus: Industry and funding stage
    - target_titles: Decision maker titles
    - lead_distribution: How many from each source

  agent: strategy_planner


reddit_prospecting:
  description: |
    Execute Reddit strategy using the plan from strategy_planner.
    Target: ~33% of {target_leads} leads

    YOU HAVE THE STRATEGY PLAN from context. Use it!

    ================================================================================
    STEPPED WORKFLOW - Execute tools in order, REASON after each step
    ================================================================================

    STEP 1: reddit_search(query)
    ----------------------------
    Use query from strategy plan. Review results:
    - Quality HIGH (>30% relevant)? -> Continue to reddit_score
    - Quality LOW? -> Try alternative query from plan
    - Still LOW after 2 tries? -> Return what you have

    Example trace:
    "Reddit search for 'project management tool' returned 50 posts, 60% relevant.
     Quality HIGH. Proceeding to scoring..."

    STEP 2: reddit_score(posts)
    ---------------------------
    Score posts for buying intent. Review:
    - Many posts >= 50? -> Continue to reddit_extract
    - Few high scores? -> Proceed but expect fewer leads

    Example trace:
    "Scoring complete. 26/50 posts scored >= 50. Good quality.
     Proceeding to lead extraction..."

    STEP 3: reddit_extract(posts)
    -----------------------------
    Extract author info as leads.
    WARNING: These leads still need seller filtering!

    Example trace:
    "Extracted 18 leads from high-quality posts.
     Running seller filter next..."

    STEP 4: filter_sellers(leads) - CRITICAL!
    -----------------------------------------
    Remove promoters. Only BUYERS remain.

    BUYER vs SELLER - THE MOST IMPORTANT RULE:
    - "I built UIBrush" = SELLER = REMOVE (Andy Roberts is NOT a lead!)
    - "Looking for AI design tool" = BUYER = KEEP

    SELLER signals (REMOVE):
    - "I built X", "We launched Y", "My startup"
    - "Check out", "Introducing", "Just launched"
    - "We developed", "I created", "My tool"

    BUYER signals (KEEP):
    - "Looking for", "Need help with", "Recommendations?"
    - "Frustrated with", "Alternative to", "Issues with"
    - Asking questions, seeking solutions

    Example trace:
    "Removed 6 sellers (Andy Roberts, SarahBuilds, LaunchMike...).
     12 BUYER leads remain."

    Return your filtered buyer leads for aggregation.

  expected_output: |
    Reddit leads with:
    - leads: Array of buyer leads (NOT sellers!)
    - count: Number of leads found
    - queries_used: Which queries worked
    - workflow_trace: Your reasoning at each step

    Each lead must have:
    - name, username
    - intent_signal: Quote showing BUYING intent
    - intent_score: 0-100
    - source_url, source_platform: "reddit"
    - priority: hot/warm/cold
    - scoring_reasoning

  agent: reddit_specialist


techcrunch_prospecting:
  description: |
    Execute TechCrunch strategy using the plan from strategy_planner.
    Target: ~33% of {target_leads} leads

    WHY TECHCRUNCH: Recently funded companies = CONFIRMED BUDGET!

    YOU HAVE THE STRATEGY PLAN from context. Use it!

    ================================================================================
    STEPPED WORKFLOW v3.4 - SERP-based decision makers (FAST!)
    ================================================================================

    STEP 1: techcrunch_fetch() OR techcrunch_fetch_parallel(pages=[1,2])
    --------------------------------------------------------------------
    Get recent funding articles.
    Use parallel fetch for more articles faster.

    Example trace:
    "Fetched 30 funding articles from TechCrunch (2 pages in parallel).
     Selecting relevant ones for target industry..."

    STEP 2: techcrunch_select_articles(articles)
    --------------------------------------------
    Select articles matching target industry from strategy plan.
    Look for Series A/B/C rounds.

    Example trace:
    "Selected 8 articles in project management/productivity space.
     Extracting company information..."

    STEP 3: techcrunch_extract_companies(articles)
    ----------------------------------------------
    Extract company name, funding amount, description.
    Returns companies ready for decision maker search.

    Example trace:
    "Extracted 8 companies with recent funding.
     Finding decision makers via SERP..."

    STEP 4: techcrunch_serp_decision_makers(companies, product_context)
    -------------------------------------------------------------------
    PREFERRED METHOD: Find ALL founders via Google SERP (~30-60s total!)
    Much faster than LinkedIn employee search (was 6-8 min).

    Searches for: Founders, Co-founders, CEO + role-specific titles
    based on product_context (e.g., CTO for dev tools, VP Sales for sales tools).

    Example trace:
    "SERP search found 24 decision makers across 8 companies in 45s.
     Running seller filter..."

    FALLBACK: If SERP fails, use linkedin_employees_batch_search(companies, query)
    But this is SLOW (~2 min per company).

    STEP 5: filter_sellers(leads)
    -----------------------------
    TechCrunch leads may include self-promoters too.
    Apply same buyer/seller logic.

    Example trace:
    "Removed 2 self-promoters.
     22 qualified decision-maker leads remain."

    Return your filtered leads for aggregation.

  expected_output: |
    TechCrunch leads with:
    - leads: Array of decision-maker leads (all founders + role-specific)
    - count: Number of leads found
    - companies_found: Companies with recent funding
    - workflow_trace: Your reasoning at each step

    Each lead must have:
    - name, title, company
    - linkedin_url: LinkedIn profile URL
    - intent_signal: Recent funding + role (e.g., "CEO of company that raised $5M Series A")
    - intent_score: 0-100
    - source_url, source_platform: "techcrunch"
    - priority: hot/warm/cold
    - scoring_reasoning

  agent: techcrunch_specialist


competitor_prospecting:
  description: |
    Execute competitor displacement strategy using the plan from strategy_planner.
    Target: ~33% of {target_leads} leads

    WHY COMPETITOR DISPLACEMENT: People engaging with competitors = interested in this space!

    YOU HAVE THE STRATEGY PLAN from context. Use it!

    ================================================================================
    STEPPED WORKFLOW - Competitor LinkedIn Posts
    ================================================================================

    STEP 1: competitor_identify(product_description, competitors)
    -------------------------------------------------------------
    Use competitors from strategy plan.
    Generate LinkedIn company page URLs.

    Example trace:
    "Strategy plan identified Figma, Canva as competitors.
     Generating LinkedIn URLs..."

    STEP 2: competitor_scrape(competitor_urls)
    ------------------------------------------
    Scrape recent posts from competitor company pages.
    Extract commenters and likers as leads.

    Example trace:
    "Scraping posts from 2 competitor pages...
     Found 35 engagers across competitor posts."

    STEP 3: filter_sellers(leads)
    -----------------------------
    Remove promoters and competitor employees.
    Keep only genuine potential buyers.

    Example trace:
    "Removed 8 sellers/competitor employees.
     27 qualified leads remain."

    Return your filtered leads for aggregation.

  expected_output: |
    Competitor leads with:
    - leads: Array of competitor engagers
    - count: Number of leads found
    - competitors_scraped: Which competitors were scraped
    - workflow_trace: Your reasoning at each step

    Each lead must have:
    - name, title, company
    - linkedin_url: LinkedIn profile URL
    - intent_signal: Engagement with competitor (e.g., "Commented on Figma post about...")
    - intent_score: 0-100
    - source_url, source_platform: "linkedin"
    - priority: hot/warm/cold
    - scoring_reasoning

  agent: competitor_specialist


aggregate_leads:
  description: |
    Combine leads from all sources into final {target_leads} qualified BUYER leads.
    IMPORTANT: Sort by intent_score (warmest first)!

    YOU HAVE LEADS FROM ALL 3 SPECIALISTS via context.

    ================================================================================
    AGGREGATION WORKFLOW
    ================================================================================

    STEP 1: RECEIVE leads from all platforms
    ----------------------------------------
    - Reddit leads (context from reddit_prospecting)
    - TechCrunch leads (context from techcrunch_prospecting)
    - Competitor leads (context from competitor_prospecting)

    Example trace:
    "Received 10 Reddit + 10 TechCrunch + 10 Competitor = 30 total.
     Running final seller check..."

    STEP 2: filter_sellers ONE MORE TIME (safety check)
    ---------------------------------------------------
    All specialists should have filtered, but double-check.

    SELLER: "I built X", "We launched Y", "My startup", "Check out"
    BUYER: "Looking for", "Need help with", "Frustrated with"

    Example trace:
    "Final seller check: Removed 2 (missed earlier).
     28 verified buyer leads remain."

    STEP 3: DEDUPLICATE
    -------------------
    Same person may appear from multiple sources.
    Keep the higher-scored version.

    Example trace:
    "Found 3 duplicates (same person across sources).
     25 unique leads remain."

    STEP 4: SORT by intent_score (HIGHEST FIRST!)
    ---------------------------------------------
    CRITICAL: Sort leads by intent_score descending.
    Warmest leads (highest scores) at the TOP of the list!

    Example trace:
    "Sorted 25 leads by intent_score. Top lead: John (score 95)."

    STEP 5: RETURN top {target_leads} leads
    ---------------------------------------
    Final output with all required fields.
    Leads MUST be sorted warmest to coldest!

  expected_output: |
    Final {target_leads} qualified BUYER leads (SORTED BY SCORE - warmest first!):

    Each lead MUST have:
    - name: Full name
    - title: Job title
    - company: Company name
    - linkedin_url: If available or null
    - email: If available or null
    - intent_signal: Quote showing BUYING intent
    - intent_score: 0-100
    - source_platform: "reddit", "techcrunch", or "linkedin"
    - source_url: Original URL where found
    - priority: "hot" (>=80), "warm" (60-79), "cold" (<60)
    - scoring_reasoning: Why this score

    Summary:
    - total_leads: Final count
    - reddit_leads_count: Count from Reddit
    - techcrunch_leads_count: Count from TechCrunch
    - competitor_leads_count: Count from competitor displacement
    - sellers_removed: Count filtered out
    - duplicates_removed: Count deduplicated
    - workflow_trace: Aggregation steps

  agent: lead_aggregator
